# ARS Interface V1.00 → V1.01 코드 기반 업데이트 가이드

작성일: 2025-08-20
출처: 실제 코드 비교 기준 (v1.00: `01_compare_old`, v1.01: `00_compare_current`)

## 목적
- 기존 문서형 가이드(요구/계획 포함) 대신, “실제 구현 코드”를 기준으로 무엇이 달라졌는지 정밀히 기술.
- 엑셀 명세(V1.01) 갱신 시 혼선을 줄이고, 코드-문서 정합성을 보장.

## 비교 기준 경로
- v1.00 코드: `communication/shared/wia_ars/01_compare_old/HWAR650V3KW_BSW/Sourcecode`
- v1.01 코드: `communication/shared/wia_ars/00_compare_current/HWAR650V3KW_BSW/Sourcecode`
- 문서/요약 참고: `ARS_BSW-ASW_Interface_V1.01_CHANGES.md`, `V1.00_to_V1.01_작업가이드.md`

---

## 변경 요약(코드 검증 완료)
- API 총수: 42 → 51 (+9) / 삭제 0 / 수정 3
- BSW→ASW(센싱·상태): ADC RAW 채널 도입, VUC 전압 3V3→5V0, SENT SlowChannel 추가, CPU Load 제공, Init3 추가
- ASW→BSW(제어·전송): CAN RX 인덱스 전면 교체(VPC/SEA → MVPC/ROUTING), TX 인덱스 MEAS 계열 추가, 타임아웃/채널 제어 API 신설
- 시스템: 듀얼 CAN 채널(CH1) 지원, ShutdownRequest/TargetAxle 추가, CPU Load API 구현

---

## 세부 변화 — 코드 근거와 반영 방법

### 1) ADC 채널/진단 (BSW→ASW)
- 파일: v1.01 `Ifc_ASW/inc/BswAdc.h`
  - 변경점(매크로):
    - `BSWADC_CH_SENS_CURR_U_RAW(0)`, `..._W_RAW(1)`, `..._DC_RAW(2)` 신설
    - `BSWADC_CH_VUC_5V0(8)`로 변경(기존 v1.00: `VUC_3V3`)
  - 신규 API 프로토타입:
    - `uint8 ShrHWIA_BswAdc_GetCurrentCalibStatus(void);`
    - `uint8 ShrHWIA_BswAdc_GetMotorTempErrStatus(void);`
- 구현: v1.01 `Ifc_BSW/BswAdc.c`에 함수 본문 존재(코드 검색 확인)
- 엑셀 반영 지침:
  - 01_IF_BSW→ASW 시트에 RAW 접미 채널로 명세 교체
  - “전류 캘리브레이션 상태”, “모터 온도 에러 상태” 행 추가(반환값 범위 명시: InProgress/Pass/Fail, Valid/Invalid)

### 2) CAN 인덱스/구조체/제어 (양방향)
- 파일: v1.01 `Ifc_ASW/inc/BswCan.h`
  - 채널: `BSWCAN_CAN_CH1` 추가(듀얼 CAN)
  - RX 인덱스 교체:
    - 기존(v1.00): `VPC_ARS_01_10ms`, `SEA_ARS_01_1ms`, `SEA_ARS_02_1ms`
    - 신규(v1.01): `MVPC_ARS_01_1ms`, `ROUTING_01_10ms/20ms/200ms`
  - TX 인덱스 개편:
    - 신규 MEAS 계열: `MEAS_01_1ms/5ms/10ms`, `MEAS_02_5ms/10ms`
    - 기존 ARS_dev 일부 축소/대체, `ARS_dev_01_1ms`만 잔존
  - 신규 API:
    - `void ShrHWIA_BswCan_SetTimeoutMax(uint8 msg_index, uint32 timeout_max);`
    - `void ShrHWIA_BswCan_SetCh0CanDisable(uint8 disable);`
  - 구조체 정의:
    - v1.00(VPC/SEA/ARSx) → v1.01(MVPC1, RT1_10/20/200, MEAS, ARS1 재정의)
- 구현: v1.01 `Ifc_BSW/BswCan.c`에 RX/TX 케이스 및 MEAS 버퍼 할당/복사 로직 존재
- 엑셀 반영 지침:
  - 01_IF_BSW→ASW: RX 인덱스 표 전면 교체(주기/ID 주석 반영)
  - 02_IF_ASW→BSW: TX 인덱스에 MEAS 라인업 추가, DLC 값도 최신(32/16 등)으로 갱신
  - 제어 API 2종은 ASW→BSW 시트에 “동적 타임아웃 설정, CH0 송신 Disable” 항목으로 신규 행 추가
  - 구조체 명세(별도 시트 또는 부록): 각 메시지의 비트필드/엔디안/스케일·오프셋/주기·타임아웃 정의 추가

### 3) SENT (BSW→ASW)
- 파일: v1.01 `Ifc_ASW/inc/BswSent.h`
  - 함수 시그니처 변경: `ShrHWIA_BswSent_GetGearPosition(uint16* outdata1, uint8* outdata2)`
    - v1.00은 포인터 1개 시그니처
  - 신규 API: `Std_ReturnType ShrHWIA_BswSent_GetSlowChannel(uint8 msgid, uint16* outdata, uint32* outtimestamp)`
- 구현: v1.01 `Ifc_BSW/BswSent.c`에 SlowChannel 구현 확인
- 엑셀 반영 지침:
  - 01_IF_BSW→ASW에 “SENT Slow Channel(22 IDs)” 항목 추가(입력 msgId, 출력 data/timestamp)
  - GearPosition 항목은 파라미터 2개로 갱신

### 4) System (BSW→ASW, ASW→BSW)
- 파일: v1.01 `Ifc_ASW/inc/BswSys.h`
  - 신규 상수: Target Axle(`FRONT/REAR`), Undefined 포함
  - 신규 API: `ShrHWIA_BswSys_SetTargetAxle(uint8)`, `ShrHWIA_BswSys_ShutdownRequest(void)`, `ShrHWIA_BswSys_GetCpuLoad(void)`
  - 기존 API 유지: ResetReason/Status/SysTime/McuReset
- 구현: v1.01 `Ifc_BSW/BswSys.c`에 SetTargetAxle/ShutdownRequest/CpuLoad 구현 확인
- 엑셀 반영 지침:
  - 02_IF_ASW→BSW에 TargetAxle/ShutdownRequest 추가(상태값/안전 조건 명시)
  - 01_IF_BSW→ASW에 CPU Load 추가(단위 %, 갱신주기 100ms)

---

## 엑셀 V1.01 반영 단계(코드 정합성 중심)
1) 00_문서정보 갱신: 문서명/버전/작성일/변경 이력 업데이트
2) 01_IF_BSW→ASW
   - ADC 채널 테이블: RAW 접미/5V0 적용, 설명·범위 재기술
   - 신규 API 추가: CurrentCalibStatus, MotorTempErrStatus, SENT SlowChannel, CPU Load
   - 기존 항목 파라미터 변경: GearPosition 시그니처 수정
3) 02_IF_ASW→BSW
   - RX 인덱스 표 전체 교체(MVPC/ROUTING)
   - TX 인덱스에 MEAS 계열 추가, DLC 최신화, 잔존 ARS_dev는 주석으로 명확화
   - 제어 API 추가: SetTimeoutMax, SetCh0CanDisable, SetTargetAxle, ShutdownRequest
4) 구조체 명세(신규 시트 권장)
   - `typBswCanMsg_MVPC1/RT1_10/RT1_20/RT1_200/MEAS/ARS1` 등 레이아웃 표준화(비트폭·단위·스케일/오프셋)

---

## 검증 체크리스트(코드 기준)
- [ ] BswAdc.h 채널 매크로 RAW/5V0로 일치
- [ ] BswAdc.c에 2개 상태 API 구현 확인
- [ ] BswCan.h RX/TX 인덱스 및 CH1·제어 API 존재
- [ ] BswCan.c에서 MEAS 분기와 ROUTING 케이스 처리 확인
- [ ] BswSent.h SlowChannel API 및 GearPosition 시그니처 변경 반영
- [ ] BswSent.c SlowChannel 구현 확인
- [ ] BswSys.h TargetAxle/Shutdown/CpuLoad 선언 일치
- [ ] BswSys.c 해당 구현 및 갱신 주기(100ms) 확인
- [ ] 엑셀 표의 주기·DLC·ID 주석이 코드와 일치

---

## 리스크/주의
- 매크로/인덱스 변경에 따른 빌드 불일치: 명세 업데이트 전후 하위 코드 교차 점검 필요
- CAN 구조체 엔디안/비트필드 해석: MCU/컴파일러 패킹 규칙 반영 필수
- SENT SlowChannel ID 범위/타임스탬프 단위 명시 필요
- CPU Load 윈도우/샘플링 주기: 주석으로 고정값 표기(코드: 100ms)

---

## 부록 — 코드 스냅샷 근거(파일 경로)
- ADC: `.../Ifc_ASW/inc/BswAdc.h`, `.../Ifc_BSW/BswAdc.c`
- CAN: `.../Ifc_ASW/inc/BswCan.h`, `.../Ifc_BSW/BswCan.c`
- SENT: `.../Ifc_ASW/inc/BswSent.h`, `.../Ifc_BSW/BswSent.c`
- SYS: `.../Ifc_ASW/inc/BswSys.h`, `.../Ifc_BSW/BswSys.c`

---

본 가이드는 실제 구현을 기준으로 작성되었습니다. 문서 반영 후, CHANGES.md와 교차 검증하시길 권장합니다.

