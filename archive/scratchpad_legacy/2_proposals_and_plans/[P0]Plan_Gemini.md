### **프로젝트 청사진: `[P0]` 핵심 기반 강화 (Project Blueprint: `[P0]` Foundational Enhancements)**

**문서 ID:** `docs/archive/P0_planning/P0_BLUEPRINT.md`

**작성일:** (가상) 2025년 7월 25일

**1. 프로젝트 비전 및 `[P0]` 단계의 목표**

Gemini CLI 자가 개선 프로젝트의 최종 비전은 단순 실행 도구를 넘어, 스스로 추론하고 제안하며 품질을 보증하는 **'능동형 지능 파트너'**로 진화하는 것입니다.

`[P0]` 단계는 이 비전을 달성하기 위한 가장 중요한 첫걸음입니다. 현재 시스템의 불안정성을 제거하고, 향후 모든 지능형 기능이 탑재될 수 있는 **견고하고 신뢰할 수 있는 핵심 기반을 구축**하는 것을 최우선 목표로 설정합니다.

**2. `[P0]` 단계의 '완료의 정의' (Definition of Done)**

아래 4가지 핵심 목표가 달성되었을 때 `[P0]` 단계는 완료된 것으로 간주합니다.

1.  **안정적인 실행 아키텍처 확립:** 모든 외부 명령어(Git, PowerShell 등)가 Windows 환경에서 예측 가능하고 안정적으로 실행되어야 한다.
2.  **지능형 컨텍스트 엔진 기반 구축:** 워크스페이스의 정보를 구조화하고, 정책에 따라 필요한 컨텍스트를 동적으로 조합할 수 있는 기본 프레임워크가 완성되어야 한다.
3.  **메타인지 프로토콜 도입:** AI의 행동 원칙을 명문화하고, 실패로부터 학습하며, 사용자의 통제를 최우선으로 하는 메커니즘이 시스템에 내장되어야 한다.
4.  **자율 테스트 하네스 통과:** 구축된 핵심 기능의 품질을 스스로 검증할 수 있는 자동화된 테스트 스위트가 구축되고, 모든 테스트가 통과해야 한다.

**3. `[P0]` 단계 상세 실행 계획**

#### **미션 1: 명령어 실행 아키텍처 재설계**

* **문제 진단:** 현재 `invoke`의 `c.run()`과 `run_shell_command`는 문자열 기반 명령어 처리 방식으로 인해, `git commit -m "..."`과 같은 복합 인자 명령어 실행 시 Windows 셸 파싱 오류를 반복적으로 유발한다. 이는 시스템 안정성을 저해하는 가장 큰 기술적 부채이다.
* **해결 전략:**
    1.  **`runner.py` 모듈 신규 생성:** `subprocess.run`을 `shell=False` 및 **리스트 인자 방식**으로 사용하는 새로운 표준 실행기 `run_command` 함수를 구현하여 셸 파싱 문제를 원천적으로 차단한다.
    2.  **`tasks.py` 전면 리팩토링:** `tasks.py` 내의 모든 `c.run()` 호출을 `runner.run_command`로 교체하여 명령어 실행 방식을 표준화한다.
    3.  **`wip` 태스크 개선:** `git commit -m` 방식 대신, `GEMINI.md` 규칙에 명시된 `git commit -F <임시파일>` 방식을 `runner.py`를 통해 안정적으로 구현한다.

#### **미션 2: 지능형 컨텍스트 엔진 프로토타입 구축**

* **문제 진단:** 현재 세션이 시작될 때마다 `HUB.md`를 수동으로 파싱하는 방식은 비효율적이며, 확장성이 떨어진다.
* **해결 전략:**
    1.  **컨텍스트 인덱서 (`build_context_index.py`):** 워크스페이스의 모든 `.md` 파일 정보를 `context/index.json`으로 구조화하여, 필요할 때 빠르게 조회할 수 있는 기반을 마련한다.
    2.  **컨텍스트 정책 (`context_policy.yaml`):** 어떤 상황에 어떤 정보를 사용할지 정의하는 규칙 파일을 `.gemini` 폴더에 생성하여 AI의 컨텍스트 활용을 제어 가능하게 만든다.
    3.  **고성능 리트리버 (`context_store.py`):** `rank-bm25` 라이브러리를 도입하여, 단순 키워드 매칭을 넘어 관련성 높은 문서를 정밀하게 검색하는 엔진을 구현한다.
    4.  **자동 요약 및 조합기 (`summarizer.py`, `prompt_builder.py`):** 검색된 긴 문서의 핵심을 추출하고(`summarizer`), 정책에 따라 최종 프롬프트 컨텍스트를 동적으로 합성(`prompt_builder`)하는 기능을 완성한다.

#### **미션 3: 메타인지 프로토콜 확립**

* **문제 진단:** 오류 발생 시 AI가 비효율적인 루프에 빠지거나, 사용자의 명시적 지시를 무시하는 등 행동적 결함이 발견되었다.
* **해결 전략:**
    1.  **`GEMINI.md` 규칙 명문화:** **'사용자 명령 최우선 원칙'**, **'실패 기록 의무'**, **'반복 행동 금지(3-Strikes Rule)'** 등을 포함하는 **'메타인지 프로토콜'**을 `GEMINI.md`에 최상위 규칙으로 명시한다.
    2.  **실패 기록 자동화:** `runner.py`의 `run_command` 실패 시, `usage_tracker.py`를 통해 `command_error` 이벤트를 `usage.db`에 자동으로 기록하여 모든 실패를 추적 가능하게 만든다.

#### **미션 4: 자율 테스트 하네스 구축**

* **문제 진단:** 시스템의 품질을 보증할 객관적인 방법이 부재하다.
* **해결 전략:**
    1.  **`pytest` 도입:** `requirements.txt`에 `pytest`를 추가하고, `/tests` 디렉터리 구조를 확립한다.
    2.  **핵심 기능 테스트 케이스 작성:**
        * **`test_core_systems.py`**: `invoke context.build`의 성공 여부, `runner.py`의 오류 로깅 기능 등을 검증한다.
        * **`test_p0_rules.py`**: 커밋 프로토콜(`-F` 옵션 사용)과 `__lastSession__` 처리 사이클 등 `GEMINI.md`의 핵심 규칙이 코드로 올바르게 구현되었는지 검증한다.
    3.  **`invoke test` 태스크 구현:** `tasks.py`에 `test` 태스크를 추가하여, 단일 명령으로 모든 자동화 테스트를 실행하고 시스템의 무결성을 검증할 수 있도록 한다.