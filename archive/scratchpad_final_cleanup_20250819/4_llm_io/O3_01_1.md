\[Role: Tech Expert]

## ğŸ¤” Strategic Analysis

ë¦¬í¬íŠ¸ ìƒì„± ìë™í™”ì˜ ë³‘ëª©ì€ **ì™„ë£Œ íŒë³„Â·ì¬ì‹œë„ ì •ì±… ë¶€ì¬**, **ê²½ë¡œ/í™˜ê²½ ë¶ˆì¼ì¹˜**, **SyntaxError ë“± ì´ˆê¸° ì‹¤í–‰ ìì²´ ì‹¤íŒ¨**ì…ë‹ˆë‹¤. ë‘ ë¦¬í¬íŠ¸ ë³‘ë ¬ ëª¨ë‹ˆí„°ë§Â·ë¶€ë¶„ ì¬ì‹œë„Â·ëª…í™•í•œ CLI í”Œë˜ê·¸ ì„¤ê³„ë¡œ ì¦‰ì‹œ í•´ì†Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.

## ğŸ“ Expert Recommendation

ì•„ë˜ëŠ” **ë‹¤ë¥¸ LLMë“¤ì˜ ì œì•ˆ + ë‹¹ì‹ ì˜ ë¸”ë£¨í”„ë¦°íŠ¸**ë¥¼ í†µí•©Â·ê³ ë„í™”í•œ \*\*â€œCLIìš© ì§€ì¹¨ì„œ(Instruction Block)â€\*\*ì…ë‹ˆë‹¤. ì´ ë¸”ë¡ ê·¸ëŒ€ë¡œ Gemini CLI(ë˜ëŠ” TerminalX ìë™í™” CLI)ì— ì…ë ¥(í”„ë¡¬í”„íŠ¸/ì„¤ì • íŒŒì¼)í•˜ë©´, êµ¬í˜„Â·ë¦¬íŒ©í† ë§Â·í…ŒìŠ¤íŠ¸ê°€ ì¼ê´€ë˜ê²Œ ì§„í–‰ë©ë‹ˆë‹¤.

---

### 0. Deliverable: â€œCLI\_INSTRUCTION.mdâ€ ì´ˆì•ˆ

> **ëª©í‘œ**: TerminalX ë¦¬í¬íŠ¸(Part1/Part2) ìë™ ìƒì„± â†’ Archive ëª¨ë‹ˆí„°ë§ â†’ HTML ì¶”ì¶œ â†’ JSON ë³€í™˜ê¹Œì§€ **ì™„ì „ ìë™í™”**
> **í•µì‹¬ ì›ì¹™**:
>
> * **ë³‘ë ¬ ëª¨ë‹ˆí„°ë§**: ë‘˜ ë‹¤ â€œGeneratingâ€ ìƒíƒœì—ì„œ ì‹œì‘, Archiveì—ì„œ â€œGeneratedâ€ ë™ì‹œ í™•ì¸
> * **ë¶€ë¶„ ì¬ì‹œë„**: ì‹¤íŒ¨í•œ ë¦¬í¬íŠ¸ë§Œ ì¬ìƒì„±
> * **êµ¬ë¬¸/ê²½ë¡œ ì•ˆì •í™”**: SyntaxError ì œê±°, ê²½ë¡œ ì¼ì›í™”
> * **ëª…ì‹œì  íƒ€ì„ì•„ì›ƒÂ·ë°±ì˜¤í”„**: ë¬´í•œ ëŒ€ê¸° ê¸ˆì§€, ë¡œê·¸ ëª…í™•í™”

---

### 1. CLIì— ì „ë‹¬í•  Instruction Block (ë³µì‚¬/ë¶™ì—¬ë„£ê¸°ìš©)

```text
# ROLE
Automation Orchestrator for TerminalX Reports (Gemini CLI executor)

# GOALS
1. Run `main_generator.py` to generate Part1 & Part2 reports automatically.
2. Do NOT wait inside the generation function; only confirm "Generating..." then return URL+Title.
3. Poll the Archive page until BOTH reports are "Generated". Abort if any is "Failed" after retry limit.
4. Extract each report HTML, convert to JSON, and integrate.

# CONSTRAINTS
- Python 3.10+ / Selenium 4.x
- Paths must use project-relative constants; no hard-coded absolute paths.
- No blocking on UI signals beyond defined waits; use intelligent backoff (30sâ†’45sâ†’60s).
- Timeout for a full batch: 30 minutes (configurable).

# DIRECTORY & PATH POLICY
- `project_root = dirname(main_generator.py)`
- `generated_html_dir = project_root/generated_html`
- `generated_json_dir = project_root/generated_json`
- `chromedriver_path = project_root/chromedriver.exe`
- Move all magic paths into a single `paths.py` or into FenokReportGenerator.__init__ cleanly.

# PHASES
Phase 1: Trigger Part1 & Part2 generation
  - `generate_report_html(part_type, idx, date_str, ref_start, ref_end)` returns (url, title).
  - On success => Append to `generated_reports_info`.
  - On failure => Retry <= MAX_RETRIES. If still fail => mark batch fail.

Phase 2: Archive polling
  - `_wait_for_all_reports_to_be_generated(reports, target="Generated", timeout=1800, attempts=3)`
    - Refresh Archive page periodically, extract status by title
    - If any "Failed": return False immediately
    - If all "Generated": return True

Phase 3: Extract & Convert
  - For each `report` in reports:
    - goto URL, dump `page_source` to HTML
    - run `convert_html_to_json(html)`; store per part
  - run `integrate_json_data(part_jsons, instruction_file)` to build final integrated JSON

# RETRY POLICY
- Generation Request Retry: per report, MAX_RETRIES=3 (interval 10s)
- Status Polling Attempt: attempts=3; each attempt loops until `timeout` with backoff on refresh
- On "Failed": re-generate only the failed report; do NOT restart success ones
- On repeated "Failed": stop and raise error

# LOGGING
- Use Python `logging` module. Levels: INFO for normal, WARNING for slow waits, ERROR for failures.
- Timestamp every status transition and retry.
- Output a summary at end: #success, #failed, total time.

# FLAGS (CLI Arguments)
--dry-run            : run until clicking "Generate" but skip actual click
--resume             : skip Phase1 if HTMLs exist, go directly to Phase2/3
--force              : ignore existing outputs; regenerate everything
--timeout N          : override default 1800s archive waiting timeout
--headless / --debug : toggle Selenium headless mode or show browser GUI

# ERROR TAXONOMY
- SyntaxError / ImportError: exit immediately, suggest `pip install -r requirements.txt`
- LoginFailedError: stop (wrong credentials or UI change)
- GenerationFailedError: captured per report; requeue or stop after 3 tries
- TimeoutError: archive wait exceeded; preserve partial logs/artifacts

# TEST MATRIX
1) Happy path: Both generated fast (â‰¤5min)
2) One slow, one fast: ensure loop waits for the slow one
3) One "Failed": 1st retry success
4) Both "Failed": stop at attempt #3
5) Archive DOM changed: handle NoSuchElementException gracefully

# EXIT CRITERIA
- final JSON file(s) present in generated_json_dir
- final HTML file(s) present in generated_html_dir
- console log shows "--- ìë™í™” ì™„ë£Œ ---"
```

---

### 2. ë©”ì¸ ì½”ë“œ êµ¬ì¡° ê°œí¸ì•ˆ (í•µì‹¬ë§Œ ì œì‹œ)

#### 2.1 ReportBatch / DTO ê°œë… ë„ì…

```python
@dataclass
class ReportTask:
    part_type: str
    index: int
    title: str = ""
    url: str = ""
    status: str = "Pending"
    retries: int = 0
```

#### 2.2 run\_full\_automation ê°„ê²°í™”

```python
def run_full_automation(self):
    self._preflight_checks()
    assert self._login_terminalx(), "ë¡œê·¸ì¸ ì‹¤íŒ¨"

    reports = [ReportTask("Part1", 1), ReportTask("Part2", 1)]
    self._phase1_trigger_generation(reports)            # fire-and-forget
    ok = self._phase2_wait_archive(reports)              # poll archive
    if not ok:
        self._handle_failures(reports)
        return

    self._phase3_extract_and_convert(reports)
    print("\n--- ìë™í™” ì™„ë£Œ ---")
```

#### 2.3 ë³‘ë ¬ ëª¨ë‹ˆí„°ìš© í•¨ìˆ˜

```python
def _phase2_wait_archive(self, reports, timeout=1800, attempts=3):
    return self._wait_for_all_reports_to_be_generated(reports, "Generated", timeout, attempts)
```

---

### 3. ë‹¤ë¥¸ LLM ê³„íš ëŒ€ë¹„ ì—…ê·¸ë ˆì´ë“œ í¬ì¸íŠ¸ ìš”ì•½

| í•­ëª©          | ê¸°ì¡´ íƒ€ LLM ì œì•ˆ  | ë³¸ ê°œì„ ì•ˆ(ìµœì¢…)                                     |
| ----------- | ------------ | --------------------------------------------- |
| SyntaxError | ë‹¨ìˆœ êµì • ì§€ì      | **êµì • + ì‚¬ì „ lint ë‹¨ê³„ ì‚½ì…(black/ruff)**            |
| ê²½ë¡œ êµ¬ì¡°       | êµ¬ì¡° ë‹¨ìˆœí™” ê¶Œê³     | **paths.pyë¡œ ë¶„ë¦¬, CLI í”Œë˜ê·¸ë¡œ override ê°€ëŠ¥**        |
| ìƒíƒœ ëª¨ë‹ˆí„°ë§     | ë‹¨ì¼ í•¨ìˆ˜ ì¬ì‘ì„±    | **ë¦¬í¬íŠ¸ ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜ ëª¨ë‹ˆí„°ë§ + backoff + ë¶€ë¶„ ì¬ì‹œë„**        |
| ì¬ì‹œë„ ì •ì±…      | 2\~3íšŒ ì¬ì‹œë„ ì œì•ˆ | **ë¶€ë¶„ ì¬ì‹œë„ + ì‹¤íŒ¨ ëˆ„ì  ì‹œ Batch Abort & Alert Hook** |
| í…ŒìŠ¤íŠ¸ í”Œëœ      | ì–¸ê¸‰ ë¶€ì¬        | **í‘œì¤€ í…ŒìŠ¤íŠ¸ ë§¤íŠ¸ë¦­ìŠ¤ ì œì‹œ**                            |
| ë¡œê·¸/ë¦¬í¬íŒ…      | print ìœ„ì£¼     | **logging ëª¨ë“ˆ, ìš”ì•½ ë¦¬í¬íŠ¸ ì¶œë ¥**                     |
| ìœ ì§€ë³´ìˆ˜ì„±       | í•¨ìˆ˜ë¥¼ ëŠ˜ë¦¼       | **ë¶„í•  ì„¤ê³„ + DTO + ì—ëŸ¬ í´ë˜ìŠ¤í™”**                     |

---

### 4. Pre-flight Checklist (CLI ì‹¤í–‰ ì „ ìë™ ì ê²€)

1. **Python/Selenium ë²„ì „ í™•ì¸**: `python --version`, `pip list | grep selenium`
2. **Chromedriver ì¡´ì¬/ë²„ì „ ë§¤ì¹­**
3. **Secrets/ê³„ì • ì •ë³´ í™•ì¸** (ë¡œê·¸ì¸ ì‹¤íŒ¨ ì‹œ ì¦‰ì‹œ ì¤‘ë‹¨)
4. **folders ì¡´ì¬ ì—¬ë¶€**: `generated_html`, `generated_json`
5. **requirements ì„¤ì¹˜**: `pip install -r requirements.txt`
6. **main\_generator.py Lint**: `python -m py_compile main_generator.py` ë˜ëŠ” `ruff check`

---

### 5. ì—ëŸ¬/ì˜ˆì™¸ í•¸ë“¤ë§ ê°€ì´ë“œ

* **Login ì‹¤íŒ¨**: ì¦‰ì‹œ ì¢…ë£Œ, Slack/ë©”ì¼ ì•Œë¦¼(í›„í¬ ì¶”ê°€ ê°€ëŠ¥)
* **DOM ë³€ê²½**: XPath ìš°íšŒìš© selector fallback ì¤€ë¹„ (e.g., `contains(., 'Generated')` â†’ CSS nth-child)
* **Timeout**: íƒ€ì„ì•„ì›ƒ ê¸°ì¤€ ì´ˆê³¼â†’ í”„ë¡œì„¸ìŠ¤ ì¤‘ë‹¨, ë¡œê·¸ ê¸°ë¡, HTML ìŠ¤ëƒ…ìƒ· ì €ì¥
* **convert\_html\_to\_json ì‹¤íŒ¨**: í•´ë‹¹ Partë§Œ ì¬ì‹œë„ ë˜ëŠ” ì˜¤ë¥˜ ìŠ¤í‚µ í›„ ë¡œê·¸ ì¶œë ¥

---

### 6. ë°°í¬ ë° ì‹¤í–‰ ìë™í™”

* `install_dependencies.bat` â†’ Windows í™˜ê²½ ì¼ê´„ ì„¤ì¹˜(í™•ì¸ í•„ìš”)
* GitHub Actions or Windows Task Schedulerë¡œ ì£¼ê¸° ì‹¤í–‰
* ë¡œê·¸/ê²°ê³¼ë¬¼ì„ Slack/Teams Webhookìœ¼ë¡œ ìë™ ë³´ê³ 

---

### 7. ë‹¤ìŒ ì•¡ì…˜

1. **ì´ ì§€ì¹¨ì„œ(Instruction Block)ë¥¼ CLI í”„ë¡¬í”„íŠ¸/ì„¤ì •íŒŒì¼ë¡œ ì£¼ì…**
2. `main_generator.py`ë¥¼ ìœ„ êµ¬ì¡°ëŒ€ë¡œ íŒ¨ì¹˜
3. Dry-run â†’ ì‹¤ì œ ì‹¤í–‰ â†’ ì‹¤íŒ¨ ì¼€ì´ìŠ¤ ì¬í˜„Â·ì ê²€
4. ê²°ê³¼ JSON êµ¬ì¡° í™•ì¸ í›„, ë‹¤ìš´ìŠ¤íŠ¸ë¦¼(ëŒ€ì‹œë³´ë“œ/ë³´ê³ ì„œ í†µí•©) ë¡œì§ ì—°ê²°

---

í•„ìš”í•˜ë‹¤ë©´ **patch diff** í˜•íƒœë¡œ ë³´ë‚´ë“œë¦¬ê±°ë‚˜, **í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸/ìœ ë‹›í…ŒìŠ¤íŠ¸ í…œí”Œë¦¿**ê¹Œì§€ ë§Œë“¤ì–´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
ì¶”ê°€ ìš”ì²­ì´ ìˆìœ¼ì‹œë©´ ì•Œë ¤ì£¼ì„¸ìš”.
