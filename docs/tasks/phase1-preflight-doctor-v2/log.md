# Phase 1: Preflight Doctor v2.0 고도화 - 작업 로그

**작업 ID**: phase1-preflight-doctor-v2  
**우선순위**: P0 (최우선)  
**담당**: Claude (총감독관)  
**시작일**: 2025-08-20  
**목표 완료**: 2025-11-20 (3개월)  
**상태**: 계획 수립 완료

---

## 🎯 작업 목표

**핵심 목표**: "실패를 사전에 잡는" 지능형 진단 시스템
- 사전 환경 검증 자동화
- 문제 예측 및 자동 수정  
- 실시간 가이드 제공
- **목표 효과**: 시스템 안정성 95% → 98%

---

## 📋 상세 작업 계획

### 1. 현재 doctor.py 확장 분석
**무엇을**: 기존 `scripts/doctor.py`의 완전한 고도화
**어떻게 분석**: 
- 현재 검증 항목과 누락 항목 매핑
- 실패 케이스 패턴 분석 (로그 기반)
- Windows 특화 검증 로직 요구사항 도출
- 사용자 피드백 기반 개선점 도출

**분석 기준**:
- 현재 doctor.py의 검증 커버리지 분석
- 최근 6개월 시스템 장애 로그 분석  
- 권한/훅/경로/브랜치/remote/PAT 관련 이슈 빈도
- Windows 인용 규칙 위반 케이스 분석

**구체적 산출물**:
- `doctor_analysis_report.md` - 현재 상태 진단 보고서
- `doctor_gap_analysis.md` - 누락 기능 분석
- 확장 설계 문서

### 2. 지능형 검증 시스템 설계
**무엇을**: [PASS]/[WARN]/[FAIL] 3단계 스마트 진단
**어떻게 설계**:
- **종합 검증 스코프**: 권한·훅·경로·브랜치·remote·PAT·워크플로·Windows 인용 규칙
- **동작 방식**: `venv/Scripts/python -m scripts.doctor_ext` 형태 실행
- **스마트 판단**: 컨텍스트 기반 우선순위 결정
- **조치 가이드**: 각 문제별 구체적 해결 방법 제시

**분석 기준**:
- 문제 복잡도별 분류 (단순/중간/복합)
- 자동 수정 가능성 평가 (안전성 기준)
- 사용자 개입 필요성 판단 기준
- 실행 시간 최적화 요구사항

**구체적 산출물**:
- `scripts/doctor_ext.py` - 확장된 메인 모듈
- `scripts/doctor/validators/` - 검증 모듈들
- `scripts/doctor/fixers/` - 자동 수정 모듈들
- 검증 결과 리포트 템플릿

### 3. 자동 수정 시스템
**무엇을**: 안전한 항목만 자동 수정하는 시스템
**어떻게 설계**:
- **안전 기준 수립**: 데이터 손실 위험이 없는 항목만
- **수정 범위**: 누락된 디렉터리 생성, 기본 브랜치 감지, 권한 설정
- **위험 작업**: 수정 제안만 하고 사용자 승인 필요
- **롤백 지원**: 모든 자동 수정에 대한 되돌리기 지원

**분석 기준**:
- 자동 수정 안전성 매트릭스 작성
- 수정 실패 시 복구 시나리오 설계
- 사용자 확인이 필요한 경계선 정의
- 수정 결과 검증 로직 설계

**구체적 산출물**:
- `scripts/doctor/auto_fix.py` - 자동 수정 엔진
- `scripts/doctor/safety_rules.py` - 안전 규칙 정의
- 수정 전후 상태 비교 리포트
- 롤백 실행 스크립트

### 4. 로깅 및 모니터링
**무엇을**: 완전한 진단 이력 관리 시스템
**어떻게 설계**:
- **로그 저장**: `usage.db` 또는 `logs/doctor/`에 구조화된 로그
- **추적 항목**: 일시/결과/수정사항/소요시간/오류내용
- **대시보드**: 진단 결과 시각화 및 트렌드 분석
- **알림 시스템**: 중요한 문제 발생 시 즉시 알림

**분석 기준**:
- 로그 데이터 구조 및 스키마 설계
- 성능 지표 수집 방법 정의
- 문제 발생 패턴 분석 알고리즘
- 리포트 자동 생성 로직

**구체적 산출물**:
- `scripts/doctor/logger.py` - 로깅 시스템
- `scripts/doctor/dashboard.py` - 결과 시각화
- SQLite 스키마 확장
- 정기 리포트 자동 생성 스크립트

---

## 📊 성공 지표 (KPI)

### 정량적 지표
- **사전 감지율**: 시스템 장애의 80% 이상 사전 감지
- **자동 수정률**: 감지된 문제의 60% 이상 자동 해결
- **진단 시간**: 전체 환경 검증 5분 이내 완료
- **거짓 양성률**: 5% 이하 유지

### 정성적 지표
- 사용자 만족도 향상 (진단 정확도)
- 문제 해결 가이드 유용성
- 시스템 신뢰도 증가

---

## 🧠 설계 분석 방법

### 현재 상태 기준선 수립
1. **기존 doctor.py 코드 분석**: 현재 검증 로직 매핑
2. **장애 로그 분석**: 최근 6개월 시스템 문제 케이스 분석
3. **사용자 피드백 수집**: HUB.md, 커뮤니케이션 로그에서 문제점 추출

### 확장 설계 검증
1. **시뮬레이션 테스트**: 다양한 문제 상황 재현 및 검증
2. **성능 테스트**: 대규모 프로젝트에서의 실행 시간 측정
3. **안전성 테스트**: 자동 수정 기능의 부작용 검증

---

## 🔄 진행 상황

### 2025-08-20 (작업 시작)
- [x] 청사진 기반 상세 계획 수립
- [x] HUB 등록 및 로그 파일 생성
- [ ] 현재 doctor.py 완전 분석 (다음 단계)

### 예정 마일스톤
- **Week 1**: 현재 상태 분석 및 설계 문서 완성
- **Week 2**: 확장 검증 모듈 개발 시작
- **Week 4**: 자동 수정 시스템 MVP 완성
- **Week 6**: 로깅 및 모니터링 시스템 통합
- **Week 8**: 통합 테스트 및 최적화
- **Week 10**: 사용자 테스트 및 피드백 반영
- **Week 12**: 정식 배포 및 문서화 완료

---

## 🚨 리스크 및 대응책

### 주요 리스크
1. **자동 수정의 부작용**: 예상치 못한 시스템 변경
   - **대응**: 엄격한 안전 규칙 + 완전한 롤백 지원
2. **성능 저하**: 복잡한 검증으로 인한 실행 시간 증가
   - **대응**: 병렬 처리 + 캐싱 + 점진적 검증
3. **거짓 경보**: 정상 상황을 문제로 판단
   - **대응**: 충분한 테스트 + 사용자 피드백 반영

### 완화 전략
- 단계적 기능 활성화 (기본은 안전 모드)
- 상세한 로그와 설명 제공
- 사용자 제어 옵션 다수 제공

---

## 📝 연관 작업

**의존성**: 
- 표준화 패키지와 긴밀한 연계 필요
- Windows PowerShell 래퍼 활용

**후속 작업**: 
- Phase 2 디스패처 에이전트의 환경 검증 기반 제공
- 모든 자동화 도구의 안전망 역할

**참고 문서**:
- 현재 `scripts/doctor.py` 소스코드
- `usage.db` 기존 로그 데이터
- 시스템 장애 케이스 모음

---

## 🔧 기술적 설계 고려사항

### 아키텍처 패턴
- **플러그인 아키텍처**: 검증 모듈 독립적 개발
- **전략 패턴**: 환경별 다른 검증 전략
- **관찰자 패턴**: 진단 결과 실시간 알림

### 확장성 고려
- 새로운 검증 항목 쉽게 추가 가능
- 사용자 정의 규칙 지원
- 다른 도구와의 통합 API 제공

---

**💡 기억할 점**: 이것은 단순한 도구가 아닌 **시스템의 건강 상태를 지키는 의사**입니다. 정확한 진단과 안전한 처방이 핵심입니다.